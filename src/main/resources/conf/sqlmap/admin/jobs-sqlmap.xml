<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.v4java.workflow.dao.admin.JobsDao" >

  <resultMap id="jobs-resultMap" type="jobs" >
    <id 	column="id" 			property="id" 			jdbcType="INTEGER" />
    <result column="name" 			property="name" 		jdbcType="VARCHAR" />
    <result column="description" 	property="description" 	jdbcType="VARCHAR" />
    <result column="status" 		property="status" 		jdbcType="INTEGER" />
    <result column="create_time" 	property="createTime" 	jdbcType="TIMESTAMP" />
    <!--  -->
    <result column="update_time" 	property="updateTime" 	jdbcType="TIMESTAMP" />
    <result column="system_id" 		property="systemId" 	jdbcType="INTEGER" />
  </resultMap>
  
  
   <resultMap id="jobsVO-resultMap" type="jobsVO" extends="jobs-resultMap">
  </resultMap>
  
	<insert id="insertJobs" parameterType="jobs">
		insert into jobs(
			name,description,status,system_id
		)	
		values(#{name},#{description},#{status},#{systemId})
	</insert>	
	  
	 <update id="updateJobsStatus">
	 	update 
	 			jobs
	 	set
	 			status = #{status} , update_time = now()		
	 	where
	 			id = #{Id}
	 	and
	 			(select 
						count(fn.jobs_id)
					from
						workflow_model wm
					left join	
						flow_node fn on wm.id = fn.model_id
					where
						fn.jobs_id  = #{Id} ) = 0			
	 </update>
	 
	 
	 <select id="findJobsVO" parameterType="jobsQuery" resultMap="jobsVO-resultMap">
		select 
				id,name,description,status,create_time,
				update_time 
				
		from
				jobs j
		where
				system_id = #{systemId}
		<if test="limit != null and offset != null">
			  	limit   #{offset} ,#{limit} 		
		</if>					
				
	</select>
	  
	  
	<select id="findJobsVOCount" parameterType="jobsQuery" resultType="int">
		select 
				count(id)
		from
				jobs j
		where
				system_id = #{systemId}
	</select>	
	
<!-- 	<select id="findJobsVO" parameterType="jobsQuery" resultMap="jobsVO-resultMap">
		select 
				j.id,j.name,j.description,j.status,j.system_id,
				j.create_time,j.update_time,xs.name as  system_name 
				
		from
				jobs j
		left join
				xf9_system xs on j.system_id = xs.id
		where
				system_id = #{systemId}
	</select>
	  
	  
	<select id="findJobsVOCount" parameterType="jobsQuery" resultType="int">
		select 
				count(j.id)
		from
				jobs j
		left join
				xf9_system xs on j.system_id = xs.id	
		where
				system_id = #{systemId}
	</select>	 -->  
	  
</mapper>